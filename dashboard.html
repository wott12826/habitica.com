<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habitica - Dashboard</title>
  <link rel="shortcut icon" href="static/icons/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --main-purple: #6c5ce7;
      --main-dark: #2d1436;
      --light-bg: #f8f9fa;
      --card-bg: #fff;
      --border: #e9ecef;
      --gray: #888;
      --radius: 14px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--light-bg);
      color: #222;
      min-height: 100vh;
    }
    .header {
      background: var(--main-purple);
      color: #fff;
      padding: 0 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      padding: 0 2rem;
      height: 64px;
    }
    .logo {
      font-weight: 800;
      font-size: 1.5rem;
      letter-spacing: 1px;
      margin-right: 2rem;
      color: #fff;
      text-decoration: none;
    }
    .nav {
      display: flex;
      gap: 2rem;
      flex: 1;
    }
    .nav a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      opacity: 0.9;
      transition: opacity 0.2s;
      position: relative;
    }
    .nav a.active, .nav a:hover {
      opacity: 1;
    }
    .nav a.active::after {
      content: '';
      display: block;
      height: 3px;
      background: #fff;
      border-radius: 2px;
      margin-top: 4px;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 1.2rem;
    }
    .header-actions .icon-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.2rem;
      cursor: pointer;
      margin-left: 0.5rem;
    }
    .header-actions .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      color: var(--main-purple);
      font-weight: bold;
      margin-left: 0.5rem;
    }
    .dashboard {
      max-width: 1400px;
      margin: 2.5rem auto 0 auto;
      display: flex;
      gap: 2rem;
      padding: 0 2rem;
    }
    .profile {
      width: 260px;
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 2rem 1.5rem 1.5rem 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 220px;
    }
    .profile .avatar {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    .profile .username {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
      text-align: center;
    }
    .profile .userid {
      font-size: 0.85rem;
      color: var(--gray);
      margin-bottom: 0.7rem;
      text-align: center;
    }
    .profile .level {
      font-size: 0.95rem;
      color: var(--main-purple);
      font-weight: 600;
      margin-bottom: 1.2rem;
    }
    .profile .bar-label {
      font-size: 0.85rem;
      color: var(--gray);
      margin-bottom: 0.2rem;
    }
    .profile .bar {
      width: 100%;
      height: 12px;
      background: #eee;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      overflow: hidden;
    }
    .profile .bar-inner {
      height: 100%;
      border-radius: 6px;
      transition: width 0.3s ease;
    }
    .profile .bar-inner.xp {
      background: linear-gradient(90deg, #6c5ce7, #a29bfe);
    }
    .profile .bar-inner.hp {
      background: linear-gradient(90deg, #00b894, #00cec9);
    }
    .profile .bar-label span {
      float: right;
    }
    .profile .stats {
      display: flex;
      gap: 1.2rem;
      margin: 1.2rem 0 0.5rem 0;
      justify-content: center;
    }
    .profile .stats .stat {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 1.1rem;
      color: var(--main-purple);
      font-weight: 600;
    }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .dashboard-header {
      background: var(--main-purple);
      color: #fff;
      border-radius: var(--radius);
      padding: 1.5rem 2rem;
      margin-bottom: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .dashboard-header .title {
      font-size: 1.3rem;
      font-weight: 700;
    }
    .dashboard-header .desc {
      font-size: 1rem;
      opacity: 0.9;
    }
    .dashboard-header .cta-btn {
      background: #fff;
      color: var(--main-purple);
      border: none;
      border-radius: 8px;
      padding: 0.7rem 1.5rem;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .dashboard-header .cta-btn:hover {
      background: #f3f0ff;
    }
    .tasks-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
    }
    .task-col {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      padding: 1.2rem 1rem 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .task-col .col-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .task-col .col-title {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--main-purple);
    }
    .task-col .add-btn {
      background: none;
      border: none;
      color: var(--main-purple);
      font-size: 1.2rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .task-col .add-btn:hover {
      color: #a29bfe;
    }
    .task-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }
    .task-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 0.8rem 0.7rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.03);
      display: flex;
      align-items: flex-start;
      gap: 0.7rem;
      font-size: 0.98rem;
      border-left: 4px solid #6c5ce7;
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .task-card:hover {
      background: #f0f2f5;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .task-card.negative { border-left-color: #e17055; }
    .task-card .task-title { font-weight: 600; }
    .task-card .task-desc { color: #888; font-size: 0.93rem; margin-top: 0.2rem; }
    .task-card .task-actions {
      margin-left: auto;
      display: flex;
      gap: 0.5rem;
    }
    .task-card .habit-buttons {
      display: flex;
      gap: 0.3rem;
      margin-left: auto;
    }
    .task-card .habit-btn {
      background: none;
      border: 2px solid #ddd;
      border-radius: 6px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: bold;
      transition: all 0.2s ease;
    }
    .task-card .habit-btn.plus {
      color: #00b894;
      border-color: #00b894;
    }
    .task-card .habit-btn.plus:hover {
      background: #00b894;
      color: white;
    }
    .task-card .habit-btn.minus {
      color: #e17055;
      border-color: #e17055;
    }
    .task-card .habit-btn.minus:hover {
      background: #e17055;
      color: white;
    }
    .task-card .icon-btn {
      background: none;
      border: none;
      color: #888;
      font-size: 1rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .task-card .icon-btn:hover { color: #6c5ce7; }
    .empty-state {
      color: #bbb;
      text-align: center;
      margin-top: 2rem;
      font-size: 1rem;
    }
    .reward-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.7rem;
    }
    .reward-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 0.7rem 0.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 0.97rem;
      border: 1.5px solid #e9ecef;
      position: relative;
    }
    .reward-card .reward-icon {
      font-size: 1.3rem;
      margin-bottom: 0.3rem;
      color: #6c5ce7;
    }
    .reward-card .reward-cost {
      font-size: 0.95rem;
      color: #a29bfe;
      margin-top: 0.2rem;
    }
    .footer {
      background: #f8f9fa;
      color: #888;
      margin-top: 3rem;
      padding: 2.5rem 0 1.2rem 0;
      border-top: 1px solid #e9ecef;
    }
    .footer-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 2rem;
      padding: 0 2rem;
    }
    .footer-section h4 {
      color: var(--main-purple);
      margin-bottom: 0.7rem;
      font-size: 1.08rem;
    }
    .footer-section ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .footer-section ul li {
      margin-bottom: 0.5rem;
    }
    .footer-section ul li a {
      color: #888;
      text-decoration: none;
      transition: color 0.2s;
    }
    .footer-section ul li a:hover {
      color: #6c5ce7;
    }
    .footer-bottom {
      text-align: center;
      color: #bbb;
      font-size: 0.95rem;
      margin-top: 2rem;
    }
    @media (max-width: 1100px) {
      .dashboard { flex-direction: column; }
      .profile { width: 100%; flex-direction: row; gap: 2rem; justify-content: flex-start; }
      .main { width: 100%; }
    }
    @media (max-width: 900px) {
      .tasks-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 600px) {
      .header-inner, .dashboard, .footer-inner { padding: 0 0.5rem; }
      .tasks-grid { grid-template-columns: 1fr; }
      .profile { flex-direction: column; align-items: center; }
    }
  </style>
  <style>
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(108, 92, 231, 0.97);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      min-width: 100vw;
    }
    .modal-overlay.active {
      display: flex;
    }
    .party-modal, .habit-modal {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 40px rgba(76,56,133,0.18);
      max-width: 420px;
      width: 100%;
      padding: 0;
      position: relative;
      text-align: center;
      animation: fadeIn 0.4s cubic-bezier(.4,0,.2,1);
      overflow: hidden;
    }
    .habit-modal {
      max-width: 500px;
      text-align: left;
      background: linear-gradient(135deg, #f8f9fa 80%, #e9e6fa 100%);
      box-shadow: 0 12px 48px 0 rgba(108,92,231,0.18), 0 2px 8px 0 rgba(76,56,133,0.10);
      border-radius: 22px;
      padding: 0;
      position: relative;
      animation: fadeIn 0.5s cubic-bezier(.4,0,.2,1);
      overflow: hidden;
    }
    .habit-modal .modal-content {
      align-items: stretch;
      gap: 1.2rem;
      padding: 2.5rem 2.2rem 2.2rem 2.2rem;
      background: transparent;
    }
    .habit-modal .modal-title {
      text-align: center;
      margin-bottom: 1.2rem;
      font-size: 1.35rem;
      font-weight: 800;
      color: #6c5ce7;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.7rem;
    }
    .habit-modal .modal-title::before {
      content: '\f303';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      font-size: 1.2em;
      color: #a29bfe;
      margin-right: 0.3em;
      display: inline-block;
    }
    .habit-modal .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1.1rem;
    }
    .habit-modal .form-group label {
      font-weight: 700;
      color: #5a4fd8;
      font-size: 1.01rem;
      margin-bottom: 0.2rem;
    }
    .habit-modal .form-group input,
    .habit-modal .form-group textarea,
    .habit-modal .form-group select {
      padding: 1rem;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 1.08rem;
      background: #fff;
      transition: border-color 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 4px rgba(108,92,231,0.04);
    }
    .habit-modal .form-group input:focus,
    .habit-modal .form-group textarea:focus,
    .habit-modal .form-group select:focus {
      outline: none;
      border-color: #a29bfe;
      box-shadow: 0 2px 8px rgba(108,92,231,0.10);
    }
    .habit-modal .form-group textarea {
      resize: vertical;
      min-height: 90px;
    }
    .habit-modal .checkbox-group {
      display: flex;
      gap: 1.2rem;
      margin-top: 0.5rem;
    }
    .habit-modal .checkbox-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.01rem;
      color: #6c5ce7;
    }
    .habit-modal .checkbox-item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #6c5ce7;
      border-radius: 6px;
    }
    .habit-modal .modal-actions {
      display: flex;
      gap: 1.2rem;
      margin-top: 1.5rem;
      border-top: 1px solid #ececec;
      padding-top: 1.2rem;
    }
    .habit-modal .btn {
      flex: 1;
      padding: 1rem 0.5rem;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 1.08rem;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 1px 4px rgba(108,92,231,0.04);
    }
    .habit-modal .btn-primary {
      background: linear-gradient(90deg, #6c5ce7 0%, #a29bfe 100%);
      color: white;
      box-shadow: 0 2px 8px rgba(108,92,231,0.10);
    }
    .habit-modal .btn-primary:hover {
      background: linear-gradient(90deg, #5a4fd8 0%, #6c5ce7 100%);
    }
    .habit-modal .btn-secondary {
      background: #f8f9fa;
      color: #6c5ce7;
      border: 2px solid #e9ecef;
    }
    .habit-modal .btn-secondary:hover {
      background: #ececec;
      color: #5a4fd8;
    }
    .habit-modal .btn-danger {
      background: linear-gradient(90deg, #e17055 0%, #ffb199 100%);
      color: white;
    }
    .habit-modal .btn-danger:hover {
      background: #d15a3f;
    }
    .habit-modal .close-btn {
      position: absolute;
      top: 18px;
      right: 18px;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #bbb;
      cursor: pointer;
      transition: color 0.2s;
      z-index: 2;
    }
    .habit-modal .close-btn:hover {
      color: #6c5ce7;
    }
    @media (max-width: 500px) {
      .habit-modal .modal-content { padding: 1.2rem 0.5rem; }
      .habit-modal { max-width: 98vw; }
      .habit-modal .modal-actions { flex-direction: column; }
    }
    .party-modal .party-img {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 1.2rem;
    }
    .party-modal .party-img img {
      max-width: 260px;
      width: 100%;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(108,92,231,0.08);
      background: #e9e6fa;
    }
    .modal .modal-title {
      font-size: 1.18rem;
      font-weight: 800;
      color: #6c5ce7;
      margin-bottom: 0.5rem;
    }
    .habit-modal .modal-title {
      text-align: center;
      margin-bottom: 1rem;
    }
    .modal .modal-desc {
      color: #444;
      font-size: 1.01rem;
      margin-bottom: 1.1rem;
    }
    .party-modal .party-btn {
      display: block;
      width: 100%;
      margin: 0.5rem 0 0.2rem 0;
      padding: 0.9rem 0;
      font-size: 1.08rem;
      font-weight: 700;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: linear-gradient(90deg, #6c5ce7 0%, #a29bfe 100%);
      color: #fff;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(108,92,231,0.08);
    }
    .party-modal .divider {
      width: 100%;
      height: 1px;
      background: #ececec;
      margin: 1.2rem 0 1.2rem 0;
    }
    .party-modal .group-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.7rem;
    }
    .party-modal .group-img {
      width: 120px;
      margin-bottom: 0.2rem;
    }
    .party-modal .group-img img {
      width: 100%;
      border-radius: 8px;
      background: #e9e6fa;
    }
    .party-modal .group-title {
      font-size: 1.05rem;
      font-weight: 700;
      color: #6c5ce7;
      margin-bottom: 0.2rem;
    }
    .party-modal .group-desc {
      color: #444;
      font-size: 0.97rem;
      margin-bottom: 0.7rem;
    }
    .party-modal .group-btn {
      display: block;
      width: 100%;
      margin: 0.2rem 0 0.2rem 0;
      padding: 0.8rem 0;
      font-size: 1.05rem;
      font-weight: 700;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #f3f0ff;
      color: #6c5ce7;
      border: 2px solid #a29bfe;
      transition: background 0.2s, color 0.2s;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="dashboard.html" class="logo">Habitica</a>
      <nav class="nav">
        <a href="dashboard.html" class="active">Tasks</a>
        <a href="inventory.html">Inventory</a>
        <a href="market.html">Shops</a>
        <a href="#" id="openPartyModal">Party</a>
        <a href="guild.html">Guild</a>
        <a href="challenges.html">Challenges</a>
      </nav>
      <div class="header-actions">
        <span class="stat"><i class="fa-solid fa-gem"></i> <span id="gems">0</span></span>
        <span class="stat"><i class="fa-solid fa-coins"></i> <span id="coins">0</span></span>
        <button class="icon-btn"><i class="fa-solid fa-bell"></i></button>
        <button class="icon-btn"><i class="fa-solid fa-cog"></i></button>
        <span class="avatar"><i class="fa-solid fa-user"></i></span>
      </div>
    </div>
  </header>
  <div class="dashboard">
    <aside class="profile">
      <div class="avatar"><i class="fa-solid fa-user"></i></div>
      <div>
        <div class="username">Arubi Kuroko</div>
        <div class="userid">@hb-3b3fc7b8d4ewmgmttr</div>
        <div class="level">Level <span id="level">1</span> Warrior</div>
        <div class="bar-label">XP <span id="xpDisplay">50 / 100</span></div>
        <div class="bar"><div class="bar-inner xp" id="xpBar"></div></div>
        <div class="bar-label">HP <span id="hpDisplay">50 / 50</span></div>
        <div class="bar"><div class="bar-inner hp" id="hpBar"></div></div>
        <div class="stats">
          <span class="stat"><i class="fa-solid fa-gem"></i> <span id="gemsProfile">0</span></span>
          <span class="stat"><i class="fa-solid fa-coins"></i> <span id="coinsProfile">0</span></span>
        </div>
      </div>
    </aside>
    <main class="main">
      <div class="dashboard-header">
        <div>
          <div class="title">Defeat monsters with friends</div>
          <div class="desc">Create your own party or join an existing one to complete tasks and boost motivation!</div>
        </div>
        <button class="cta-btn">Start</button>
      </div>
      <div class="tasks-grid">
        <!-- Habits -->
        <div class="task-col">
          <div class="col-header">
            <span class="col-title">Habits</span>
            <button class="add-btn" title="Add Habit" onclick="openHabitModal()"><i class="fa-solid fa-plus"></i></button>
          </div>
          <div class="task-list" id="habitsList">
            <div class="task-card negative" data-id="1">
              <div onclick="openHabitModal(1)">
                <div class="task-title">Click to mark this as a bad habit you want to break</div>
                <div class="task-desc">Or edit or delete this habit</div>
              </div>
              <div class="habit-buttons">
                <button class="habit-btn plus" onclick="updateHabit(1, 'plus')" title="Good habit (+XP)">+</button>
                <button class="habit-btn minus" onclick="updateHabit(1, 'minus')" title="Bad habit (-HP)">−</button>
              </div>
            </div>
            <div class="task-card" data-id="2">
              <div onclick="openHabitModal(2)">
                <div class="task-title">Add a Habit in Habitica</div>
                <div class="task-desc">Either a positive, negative, or both habit</div>
              </div>
              <div class="habit-buttons">
                <button class="habit-btn plus" onclick="updateHabit(2, 'plus')" title="Good habit (+XP)">+</button>
                <button class="habit-btn minus" onclick="updateHabit(2, 'minus')" title="Bad habit (-HP)">−</button>
              </div>
            </div>
          </div>
        </div>
        <!-- Dailies -->
        <div class="task-col">
          <div class="col-header">
            <span class="col-title">Dailies</span>
            <button class="add-btn" title="Add Daily" onclick="openDailyModal()"><i class="fa-solid fa-plus"></i></button>
          </div>
          <div class="task-list" id="dailiesList">
            <div class="empty-state">No dailies yet</div>
          </div>
        </div>
        <!-- To-Dos -->
        <div class="task-col">
          <div class="col-header">
            <span class="col-title">To-Dos</span>
            <button class="add-btn" title="Add To-Do" onclick="openTodoModal()"><i class="fa-solid fa-plus"></i></button>
          </div>
          <div class="task-list" id="todosList">
            <div class="task-card">
              <div>
                <div class="task-title">Join Habitica (Check me off!)</div>
                <div class="task-desc">You can complete, edit, or delete this task</div>
              </div>
              <div class="task-actions">
                <button class="icon-btn" title="Edit"><i class="fa-solid fa-pen"></i></button>
                <button class="icon-btn" title="Delete"><i class="fa-solid fa-trash"></i></button>
              </div>
            </div>
          </div>
        </div>
        <!-- Rewards -->
        <div class="task-col">
          <div class="col-header">
            <span class="col-title">Rewards</span>
            <button class="add-btn" title="Add Reward" onclick="openRewardModal()"><i class="fa-solid fa-plus"></i></button>
          </div>
          <div class="reward-list" id="rewardsList">
            <div class="reward-card">
              <div class="reward-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
              <div>Watch TV</div>
              <div class="reward-cost">10</div>
            </div>
            <div class="reward-card">
              <div class="reward-icon"><i class="fa-solid fa-gamepad"></i></div>
              <div>Play a game</div>
              <div class="reward-cost">20</div>
            </div>
            <div class="reward-card">
              <div class="reward-icon"><i class="fa-solid fa-cookie-bite"></i></div>
              <div>Eat a treat</div>
              <div class="reward-cost">15</div>
            </div>
            <div class="reward-card">
              <div class="reward-icon"><i class="fa-solid fa-crown"></i></div>
              <div>Special reward</div>
              <div class="reward-cost">100</div>
            </div>
          </div>
          <div class="reward-list" id="specialRewardsList">
            <div class="reward-card">
              <div class="reward-icon"><img src="static/icons/scallop-helm.png" alt="Scallop Helm" style="width:40px;height:40px;"></div>
              <div>Scallop Helm</div>
              <div class="reward-cost"><i class="fa-solid fa-coins"></i> 60</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-section">
        <h4>Product</h4>
        <ul>
          <li><a href="#">iOS App</a></li>
          <li><a href="#">Android App</a></li>
          <li><a href="#">Group Plans</a></li>
          <li><a href="#">How it works</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Company</h4>
        <ul>
          <li><a href="#">Contact</a></li>
          <li><a href="#">Press</a></li>
          <li><a href="#">Blog</a></li>
          <li><a href="#">News</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Community</h4>
        <ul>
          <li><a href="#">Community Guidelines</a></li>
          <li><a href="#">Hall of Heroes</a></li>
          <li><a href="#">Contribute</a></li>
          <li><a href="#">Translate Habitica</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Support</h4>
        <ul>
          <li><a href="#">FAQ</a></li>
          <li><a href="#">Report a Problem</a></li>
          <li><a href="#">Suggest a Feature</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Developers</h4>
        <ul>
          <li><a href="#">API v3</a></li>
          <li><a href="#">Data Display</a></li>
          <li><a href="#">Blacksmiths Guide</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      &copy; 2025 Habitica. All rights reserved.
    </div>
  </footer>
  
  <!-- Party Modal -->
  <div class="modal-overlay" id="partyModal">
    <div class="party-modal">
      <button class="close-btn" onclick="closeModal('partyModal')" title="Close">&times;</button>
      <div class="modal-content">
        <div class="party-img">
          <img src="static/icons/group@3x-BRelOOPS.png" alt="Party Pixel Art">
        </div>
        <div class="modal-title">Play Habitica in a Party!</div>
        <div class="modal-desc">Go on amazing Quests with friends or solo. Battle monsters, create challenges, and help each other stay accountable with a party!</div>
        <button class="party-btn">Create Party</button>
        <div class="divider"></div>
        <div class="group-block">
          <div class="group-img">
            <img src="static/icons/party-BBgVse-q.png" alt="Group Pixel Art">
          </div>
          <div class="group-title">Looking for a Party?</div>
          <div class="group-desc">Want to join a party but don't know other players? Let party leaders know you want to get invited!</div>
          <button class="group-btn">Find Party</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Habit Edit Modal -->
  <div class="modal-overlay" id="habitModal">
    <div class="habit-modal">
      <button class="close-btn" onclick="closeModal('habitModal')" title="Close">&times;</button>
      <div class="modal-content">
        <div class="modal-title">Edit Habit</div>
        <form id="habitForm">
          <div class="form-group">
            <label for="habitTitle">Title</label>
            <input type="text" id="habitTitle" name="title" placeholder="Enter habit title" required>
          </div>
          <div class="form-group">
            <label for="habitNotes">Notes</label>
            <textarea id="habitNotes" name="notes" placeholder="Add notes about this habit"></textarea>
          </div>
          <div class="form-group">
            <label for="habitDifficulty">Difficulty</label>
            <select id="habitDifficulty" name="difficulty">
              <option value="trivial">Trivial</option>
              <option value="easy">Easy</option>
              <option value="medium" selected>Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
          <div class="form-group">
            <label for="habitTags">Tags</label>
            <input type="text" id="habitTags" name="tags" placeholder="Enter tags separated by commas">
          </div>
          <div class="form-group">
            <label>Habit Type</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="positiveHabit" name="positive" checked>
                <label for="positiveHabit">Positive habit (+XP)</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="negativeHabit" name="negative">
                <label for="negativeHabit">Negative habit (-HP)</label>
              </div>
            </div>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-danger" onclick="deleteHabit()">Delete</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('habitModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Daily Edit Modal -->
  <div class="modal-overlay" id="dailyModal">
    <div class="habit-modal">
      <button class="close-btn" onclick="closeModal('dailyModal')" title="Close">&times;</button>
      <div class="modal-content">
        <div class="modal-title">Edit Daily</div>
        <form id="dailyForm">
          <div class="form-group">
            <label for="dailyTitle">Title</label>
            <input type="text" id="dailyTitle" name="title" placeholder="Enter daily title" required>
          </div>
          <div class="form-group">
            <label for="dailyNotes">Notes</label>
            <textarea id="dailyNotes" name="notes" placeholder="Add notes about this daily"></textarea>
          </div>
          <div class="form-group">
            <label for="dailyDifficulty">Difficulty</label>
            <select id="dailyDifficulty" name="difficulty">
              <option value="trivial">Trivial</option>
              <option value="easy">Easy</option>
              <option value="medium" selected>Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dailyTags">Tags</label>
            <input type="text" id="dailyTags" name="tags" placeholder="Enter tags separated by commas">
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-danger" onclick="deleteDaily()">Delete</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('dailyModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- To-Do Edit Modal -->
  <div class="modal-overlay" id="todoModal">
    <div class="habit-modal">
      <button class="close-btn" onclick="closeModal('todoModal')" title="Close">&times;</button>
      <div class="modal-content">
        <div class="modal-title">Edit To-Do</div>
        <form id="todoForm">
          <div class="form-group">
            <label for="todoTitle">Title</label>
            <input type="text" id="todoTitle" name="title" placeholder="Enter to-do title" required>
          </div>
          <div class="form-group">
            <label for="todoNotes">Notes</label>
            <textarea id="todoNotes" name="notes" placeholder="Add notes about this to-do"></textarea>
          </div>
          <div class="form-group">
            <label for="todoDifficulty">Difficulty</label>
            <select id="todoDifficulty" name="difficulty">
              <option value="trivial">Trivial</option>
              <option value="easy">Easy</option>
              <option value="medium" selected>Medium</option>
              <option value="hard">Hard</option>
            </select>
          </div>
          <div class="form-group">
            <label for="todoTags">Tags</label>
            <input type="text" id="todoTags" name="tags" placeholder="Enter tags separated by commas">
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-danger" onclick="deleteTodo()">Delete</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('todoModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Reward Edit Modal -->
  <div class="modal-overlay" id="rewardModal">
    <div class="habit-modal">
      <button class="close-btn" onclick="closeModal('rewardModal')" title="Close">&times;</button>
      <div class="modal-content">
        <div class="modal-title">Edit Reward</div>
        <form id="rewardForm">
          <div class="form-group">
            <label for="rewardTitle">Title</label>
            <input type="text" id="rewardTitle" name="title" placeholder="Enter reward title" required>
          </div>
          <div class="form-group">
            <label for="rewardNotes">Notes</label>
            <textarea id="rewardNotes" name="notes" placeholder="Add notes about this reward"></textarea>
          </div>
          <div class="form-group">
            <label for="rewardPrice">Price</label>
            <input type="number" id="rewardPrice" name="price" placeholder="Enter reward price" required>
          </div>
          <div class="form-group">
            <label for="rewardTags">Tags</label>
            <input type="text" id="rewardTags" name="tags" placeholder="Enter tags separated by commas">
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-danger" onclick="deleteReward()">Delete</button>
            <button type="button" class="btn btn-secondary" onclick="closeModal('rewardModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Special Reward Modal -->
  <div class="modal-overlay" id="specialRewardModal">
    <div class="habit-modal">
      <button class="close-btn" onclick="closeModal('specialRewardModal')" title="Close">&times;</button>
      <div class="modal-content">
        <div class="modal-title">Special Reward</div>
        <div class="reward-icon">
          <img id="specialRewardIcon" src="" alt="Special Reward Icon">
        </div>
        <div class="reward-title" id="specialRewardTitle"></div>
        <div class="reward-desc" id="specialRewardDesc"></div>
        <div class="reward-price" id="specialRewardPrice"></div>
        <div class="reward-stats">
          <div>Strength: <span id="specialRewardStr">0</span></div>
          <div>Intelligence: <span id="specialRewardInt">0</span></div>
          <div>Constitution: <span id="specialRewardCon">0</span></div>
          <div>Perception: <span id="specialRewardPer">0</span></div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('specialRewardModal')">Close</button>
          <button type="button" class="btn btn-primary" onclick="buySpecialReward()">Buy</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Game state
    let gameState = {
      xp: 50,
      maxXp: 100,
      hp: 50,
      maxHp: 50,
      level: 1,
      gems: 0,
      coins: 0,
      habits: [
        {
          id: 1,
          title: "Click to mark this as a bad habit you want to break",
          notes: "Or edit or delete this habit",
          difficulty: "medium",
          tags: "",
          positive: false,
          negative: true
        },
        {
          id: 2,
          title: "Add a Habit in Habitica",
          notes: "Either a positive, negative, or both habit",
          difficulty: "medium",
          tags: "",
          positive: true,
          negative: false
        }
      ],
      dailies: [
        {
          id: 1,
          title: "Do morning exercise",
          notes: "10 push-ups or 5 min stretching",
          difficulty: "easy",
          tags: "health,fitness",
          completed: false
        }
      ],
      todos: [
        {
          id: 1,
          title: "Join Habitica (Check me off!)",
          notes: "You can complete, edit, or delete this task",
          difficulty: "easy",
          tags: "onboarding",
          completed: false
        }
      ],
      rewards: [
        {
          id: 1,
          title: "Watch TV",
          notes: "Relax and watch your favorite show",
          price: 10,
          tags: "relax"
        }
      ],
      specialRewards: [
        {
          id: 101,
          title: "Spear of Destiny",
          description: "A legendary spear that increases your Strength and Perception.",
          icon: "static/icons/spear.png",
          price: 90,
          bonuses: { str: 10, int: 0, con: 0, per: 7 },
          stats: { str: 10, int: 0, con: 0, per: 7 },
          classBonus: 4.5
        },
        {
          id: 102,
          title: "Pink Bow",
          description: "A cute bow that boosts your Intelligence and Perception.",
          icon: "static/icons/pink-bow.png",
          price: 90,
          bonuses: { str: 0, int: 8, con: 0, per: 8 },
          stats: { str: 0, int: 8, con: 0, per: 8 },
          classBonus: 3.5
        },
        {
          id: 103,
          title: "Scallop Helm",
          description: "Impenetrable and perfectly pointy, this helmet will even protect you from starfish. Increases Strength by 9. Limited Edition Summer 2025 Gear.",
          icon: "static/icons/scallop-helm.png",
          price: 60,
          bonuses: { str: 13, int: 0, con: 2, per: 0 },
          stats: { str: 9, int: 0, con: 2, per: 0 },
          classBonus: 4.5
        },
        {
          id: 104,
          title: "Blue Shell",
          description: "A rare shell that increases your Constitution and Perception.",
          icon: "static/icons/blue-shell.png",
          price: 70,
          bonuses: { str: 0, int: 0, con: 10, per: 5 },
          stats: { str: 0, int: 0, con: 10, per: 5 },
          classBonus: 2.5
        },
        {
          id: 105,
          title: "Magic Wand",
          description: "A wand that boosts your Intelligence.",
          icon: "static/icons/magic-wand.png",
          price: 1,
          bonuses: { str: 0, int: 12, con: 0, per: 0 },
          stats: { str: 0, int: 12, con: 0, per: 0 },
          classBonus: 2.0
        },
        {
          id: 106,
          title: "Crab Mount",
          description: "A sturdy crab mount that increases your Constitution.",
          icon: "static/icons/crab-mount.png",
          price: 30,
          bonuses: { str: 0, int: 0, con: 8, per: 0 },
          stats: { str: 0, int: 0, con: 8, per: 0 },
          classBonus: 1.5
        },
        {
          id: 107,
          title: "Wooden Shield",
          description: "A simple shield that increases your Constitution.",
          icon: "static/icons/wooden-shield.png",
          price: 20,
          bonuses: { str: 0, int: 0, con: 6, per: 0 },
          stats: { str: 0, int: 0, con: 6, per: 0 },
          classBonus: 1.0
        },
        {
          id: 108,
          title: "Viking Helm",
          description: "A horned helm that increases Strength and Constitution.",
          icon: "static/icons/viking-helm.png",
          price: 15,
          bonuses: { str: 5, int: 0, con: 5, per: 0 },
          stats: { str: 5, int: 0, con: 5, per: 0 },
          classBonus: 1.0
        },
        {
          id: 109,
          title: "Potion of Wisdom",
          description: "A potion that increases your Intelligence.",
          icon: "static/icons/potion-wisdom.png",
          price: 25,
          bonuses: { str: 0, int: 10, con: 0, per: 0 },
          stats: { str: 0, int: 10, con: 0, per: 0 },
          classBonus: 1.0
        },
        {
          id: 110,
          title: "Treasure Chest",
          description: "A chest full of gold! Increases all stats a little.",
          icon: "static/icons/treasure-chest.png",
          price: 100,
          bonuses: { str: 3, int: 3, con: 3, per: 3 },
          stats: { str: 3, int: 3, con: 3, per: 3 },
          classBonus: 2.0
        }
      ]
    };

    let editingHabitId = null;
    let editingDailyId = null;
    let editingTodoId = null;
    let editingRewardId = null;
    let viewingSpecialRewardId = null;

    // Initialize game
    function initGame() {
      updateDisplay();
    }

    // Update all displays
    function updateDisplay() {
      // Update XP bar
      const xpPercent = (gameState.xp / gameState.maxXp) * 100;
      document.getElementById('xpBar').style.width = xpPercent + '%';
      document.getElementById('xpDisplay').textContent = `${gameState.xp} / ${gameState.maxXp}`;
      
      // Update HP bar
      const hpPercent = (gameState.hp / gameState.maxHp) * 100;
      document.getElementById('hpBar').style.width = hpPercent + '%';
      document.getElementById('hpDisplay').textContent = `${gameState.hp} / ${gameState.maxHp}`;
      
      // Update level
      document.getElementById('level').textContent = gameState.level;
      
      // Update gems and coins
      document.getElementById('gems').textContent = gameState.gems;
      document.getElementById('gemsProfile').textContent = gameState.gems;
      document.getElementById('coins').textContent = gameState.coins;
      document.getElementById('coinsProfile').textContent = gameState.coins;
    }

    // Update habit (plus/minus buttons)
    function updateHabit(habitId, action) {
      event.stopPropagation();
      
      const habit = gameState.habits.find(h => h.id === habitId);
      if (!habit) return;

      if (action === 'plus' && habit.positive) {
        gameState.xp += 10;
        gameState.coins += 5;
        showNotification('+10 XP, +5 coins!', 'success');
      } else if (action === 'minus' && habit.negative) {
        gameState.hp = Math.max(0, gameState.hp - 5);
        showNotification('-5 HP', 'warning');
      }

      // Check for level up
      if (gameState.xp >= gameState.maxXp) {
        gameState.level++;
        gameState.xp = 0;
        gameState.maxXp = Math.floor(gameState.maxXp * 1.2);
        gameState.maxHp += 10;
        gameState.hp = gameState.maxHp;
        gameState.gems += 1;
        showNotification(`Level up! You're now level ${gameState.level}!`, 'success');
      }

      updateDisplay();
    }

    // Show notification
    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#00b894' : '#e17055'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        z-index: 10001;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    // Modal functions
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      if (modalId === 'habitModal') {
        editingHabitId = null;
        document.getElementById('habitForm').reset();
      } else if (modalId === 'dailyModal') {
        editingDailyId = null;
        document.getElementById('dailyForm').reset();
      } else if (modalId === 'todoModal') {
        editingTodoId = null;
        document.getElementById('todoForm').reset();
      } else if (modalId === 'rewardModal') {
        editingRewardId = null;
        document.getElementById('rewardForm').reset();
      } else if (modalId === 'specialRewardModal') {
        viewingSpecialRewardId = null;
        document.getElementById('specialRewardIcon').src = '';
        document.getElementById('specialRewardTitle').textContent = '';
        document.getElementById('specialRewardDesc').textContent = '';
        document.getElementById('specialRewardPrice').textContent = '';
        document.getElementById('specialRewardStr').textContent = '';
        document.getElementById('specialRewardInt').textContent = '';
        document.getElementById('specialRewardCon').textContent = '';
        document.getElementById('specialRewardPer').textContent = '';
      }
    }

    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    // Habit modal functions
    function openHabitModal(habitId = null) {
      editingHabitId = habitId;
      const form = document.getElementById('habitForm');
      
      if (habitId) {
        // Edit existing habit
        const habit = gameState.habits.find(h => h.id === habitId);
        if (habit) {
          document.getElementById('habitTitle').value = habit.title;
          document.getElementById('habitNotes').value = habit.notes;
          document.getElementById('habitDifficulty').value = habit.difficulty;
          document.getElementById('habitTags').value = habit.tags;
          document.getElementById('positiveHabit').checked = habit.positive;
          document.getElementById('negativeHabit').checked = habit.negative;
        }
      } else {
        // New habit
        form.reset();
        document.getElementById('habitTitle').value = '';
        document.getElementById('habitNotes').value = '';
        document.getElementById('habitDifficulty').value = 'medium';
        document.getElementById('habitTags').value = '';
        document.getElementById('positiveHabit').checked = true;
        document.getElementById('negativeHabit').checked = false;
      }
      
      openModal('habitModal');
    }

    // Save habit
    document.getElementById('habitForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const habitData = {
        title: formData.get('title'),
        notes: formData.get('notes'),
        difficulty: formData.get('difficulty'),
        tags: formData.get('tags'),
        positive: formData.get('positive') === 'on',
        negative: formData.get('negative') === 'on'
      };

      if (editingHabitId) {
        // Update existing habit
        const habitIndex = gameState.habits.findIndex(h => h.id === editingHabitId);
        if (habitIndex !== -1) {
          gameState.habits[habitIndex] = { ...gameState.habits[habitIndex], ...habitData };
          updateHabitsList();
        }
      } else {
        // Add new habit
        const newHabit = {
          id: Date.now(),
          ...habitData
        };
        gameState.habits.push(newHabit);
        updateHabitsList();
      }

      closeModal('habitModal');
      showNotification('Habit saved successfully!', 'success');
    });

    // Delete habit
    function deleteHabit() {
      if (!editingHabitId) return;
      
      if (confirm('Are you sure you want to delete this habit?')) {
        gameState.habits = gameState.habits.filter(h => h.id !== editingHabitId);
        updateHabitsList();
        closeModal('habitModal');
        showNotification('Habit deleted successfully!', 'success');
      }
    }

    // Update habits list display
    function updateHabitsList() {
      const habitsList = document.getElementById('habitsList');
      habitsList.innerHTML = '';
      
      gameState.habits.forEach(habit => {
        const habitCard = document.createElement('div');
        habitCard.className = `task-card ${habit.negative ? 'negative' : ''}`;
        habitCard.setAttribute('data-id', habit.id);
        
        habitCard.innerHTML = `
          <div onclick="openHabitModal(${habit.id})">
            <div class="task-title">${habit.title}</div>
            <div class="task-desc">${habit.notes || 'No notes'}</div>
          </div>
          <div class="habit-buttons">
            ${habit.positive ? `<button class="habit-btn plus" onclick="updateHabit(${habit.id}, 'plus')" title="Good habit (+XP)">+</button>` : ''}
            ${habit.negative ? `<button class="habit-btn minus" onclick="updateHabit(${habit.id}, 'minus')" title="Bad habit (-HP)">−</button>` : ''}
          </div>
        `;
        
        habitsList.appendChild(habitCard);
      });
    }

    // Party modal event listeners
    document.getElementById('openPartyModal').addEventListener('click', function(e) {
      e.preventDefault();
      openModal('partyModal');
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal('partyModal');
        closeModal('habitModal');
        closeModal('dailyModal');
        closeModal('todoModal');
        closeModal('rewardModal');
        closeModal('specialRewardModal');
      }
    });

    // Close modals by clicking outside
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function(e) {
        if (e.target === this) {
          closeModal(this.id);
        }
      });
    });

    // Add CSS animations for notifications
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // Dailies logic
    function updateDailiesList() {
      const dailiesList = document.getElementById('dailiesList');
      dailiesList.innerHTML = '';
      if (gameState.dailies.length === 0) {
        dailiesList.innerHTML = '<div class="empty-state">No dailies yet</div>';
        return;
      }
      gameState.dailies.forEach(daily => {
        const dailyCard = document.createElement('div');
        dailyCard.className = 'task-card';
        dailyCard.setAttribute('data-id', daily.id);
        dailyCard.innerHTML = `
          <input type="checkbox" class="daily-checkbox" ${daily.completed ? 'checked' : ''} onclick="toggleDailyComplete(${daily.id}, event)">
          <div style="flex:1;cursor:pointer;" onclick="openDailyModal(${daily.id})">
            <div class="task-title">${daily.title}</div>
            <div class="task-desc">${daily.notes || ''}</div>
          </div>
          <div class="task-actions">
            <button class="icon-btn" title="Edit" onclick="openDailyModal(${daily.id}, event)"><i class="fa-solid fa-pen"></i></button>
            <button class="icon-btn" title="Delete" onclick="deleteDaily(${daily.id}, event)"><i class="fa-solid fa-trash"></i></button>
          </div>
        `;
        dailiesList.appendChild(dailyCard);
      });
    }

    function toggleDailyComplete(dailyId, e) {
      e.stopPropagation();
      const daily = gameState.dailies.find(d => d.id === dailyId);
      if (!daily) return;
      daily.completed = !daily.completed;
      if (daily.completed) {
        gameState.xp += 15;
        gameState.coins += 7;
        showNotification('+15 XP, +7 coins!', 'success');
      }
      updateDisplay();
      updateDailiesList();
    }

    function openDailyModal(dailyId = null, e) {
      if (e) e.stopPropagation();
      editingDailyId = dailyId;
      const form = document.getElementById('dailyForm');
      if (dailyId) {
        const daily = gameState.dailies.find(d => d.id === dailyId);
        if (daily) {
          document.getElementById('dailyTitle').value = daily.title;
          document.getElementById('dailyNotes').value = daily.notes;
          document.getElementById('dailyDifficulty').value = daily.difficulty;
          document.getElementById('dailyTags').value = daily.tags;
        }
      } else {
        form.reset();
        document.getElementById('dailyTitle').value = '';
        document.getElementById('dailyNotes').value = '';
        document.getElementById('dailyDifficulty').value = 'medium';
        document.getElementById('dailyTags').value = '';
      }
      openModal('dailyModal');
    }

    document.getElementById('dailyForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const dailyData = {
        title: formData.get('title'),
        notes: formData.get('notes'),
        difficulty: formData.get('difficulty'),
        tags: formData.get('tags'),
        completed: false
      };
      if (editingDailyId) {
        const dailyIndex = gameState.dailies.findIndex(d => d.id === editingDailyId);
        if (dailyIndex !== -1) {
          gameState.dailies[dailyIndex] = { ...gameState.dailies[dailyIndex], ...dailyData };
          updateDailiesList();
        }
      } else {
        const newDaily = {
          id: Date.now(),
          ...dailyData
        };
        gameState.dailies.push(newDaily);
        updateDailiesList();
      }
      closeModal('dailyModal');
      showNotification('Daily saved successfully!', 'success');
    });

    function deleteDaily(dailyId, e) {
      if (e) e.stopPropagation();
      if (confirm('Are you sure you want to delete this daily?')) {
        gameState.dailies = gameState.dailies.filter(d => d.id !== dailyId);
        updateDailiesList();
        closeModal('dailyModal');
        showNotification('Daily deleted successfully!', 'success');
      }
    }

    // To-Dos logic
    function updateTodosList() {
      const todosList = document.getElementById('todosList');
      todosList.innerHTML = '';
      if (gameState.todos.length === 0) {
        todosList.innerHTML = '<div class="empty-state">No to-dos yet</div>';
        return;
      }
      gameState.todos.forEach(todo => {
        const todoCard = document.createElement('div');
        todoCard.className = 'task-card';
        todoCard.setAttribute('data-id', todo.id);
        todoCard.innerHTML = `
          <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} onclick="toggleTodoComplete(${todo.id}, event)">
          <div style="flex:1;cursor:pointer;" onclick="openTodoModal(${todo.id})">
            <div class="task-title">${todo.title}</div>
            <div class="task-desc">${todo.notes || ''}</div>
          </div>
          <div class="task-actions">
            <button class="icon-btn" title="Edit" onclick="openTodoModal(${todo.id}, event)"><i class="fa-solid fa-pen"></i></button>
            <button class="icon-btn" title="Delete" onclick="deleteTodo(${todo.id}, event)"><i class="fa-solid fa-trash"></i></button>
          </div>
        `;
        todosList.appendChild(todoCard);
      });
    }

    function toggleTodoComplete(todoId, e) {
      e.stopPropagation();
      const todo = gameState.todos.find(t => t.id === todoId);
      if (!todo) return;
      todo.completed = !todo.completed;
      if (todo.completed) {
        gameState.xp += 20;
        gameState.coins += 10;
        showNotification('+20 XP, +10 coins!', 'success');
      }
      updateDisplay();
      updateTodosList();
    }

    function openTodoModal(todoId = null, e) {
      if (e) e.stopPropagation();
      editingTodoId = todoId;
      const form = document.getElementById('todoForm');
      if (todoId) {
        const todo = gameState.todos.find(t => t.id === todoId);
        if (todo) {
          document.getElementById('todoTitle').value = todo.title;
          document.getElementById('todoNotes').value = todo.notes;
          document.getElementById('todoDifficulty').value = todo.difficulty;
          document.getElementById('todoTags').value = todo.tags;
        }
      } else {
        form.reset();
        document.getElementById('todoTitle').value = '';
        document.getElementById('todoNotes').value = '';
        document.getElementById('todoDifficulty').value = 'medium';
        document.getElementById('todoTags').value = '';
      }
      openModal('todoModal');
    }

    document.getElementById('todoForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const todoData = {
        title: formData.get('title'),
        notes: formData.get('notes'),
        difficulty: formData.get('difficulty'),
        tags: formData.get('tags'),
        completed: false
      };
      if (editingTodoId) {
        const todoIndex = gameState.todos.findIndex(t => t.id === editingTodoId);
        if (todoIndex !== -1) {
          gameState.todos[todoIndex] = { ...gameState.todos[todoIndex], ...todoData };
          updateTodosList();
        }
      } else {
        const newTodo = {
          id: Date.now(),
          ...todoData
        };
        gameState.todos.push(newTodo);
        updateTodosList();
      }
      closeModal('todoModal');
      showNotification('To-Do saved successfully!', 'success');
    });

    function deleteTodo(todoId, e) {
      if (e) e.stopPropagation();
      if (confirm('Are you sure you want to delete this to-do?')) {
        gameState.todos = gameState.todos.filter(t => t.id !== todoId);
        updateTodosList();
        closeModal('todoModal');
        showNotification('To-Do deleted successfully!', 'success');
      }
    }

    // Rewards logic
    function updateRewardsList() {
      const rewardsList = document.getElementById('rewardsList');
      rewardsList.innerHTML = '';
      if (gameState.rewards.length === 0) {
        rewardsList.innerHTML = '<div class="empty-state">No rewards yet</div>';
      }
      gameState.rewards.forEach(reward => {
        const rewardCard = document.createElement('div');
        rewardCard.className = 'reward-card';
        rewardCard.setAttribute('data-id', reward.id);
        rewardCard.innerHTML = `
          <div class="reward-icon"><i class="fa-solid fa-wand-magic-sparkles"></i></div>
          <div>${reward.title}</div>
          <div class="reward-cost"><i class="fa-solid fa-coins"></i> ${reward.price}</div>
          <div class="task-actions">
            <button class="icon-btn" title="Edit" onclick="openRewardModal(${reward.id}, event)"><i class="fa-solid fa-pen"></i></button>
            <button class="icon-btn" title="Delete" onclick="deleteReward(${reward.id}, event)"><i class="fa-solid fa-trash"></i></button>
            <button class="icon-btn" title="Buy" onclick="buyReward(${reward.id}, event)"><i class="fa-solid fa-cart-shopping"></i></button>
          </div>
        `;
        rewardsList.appendChild(rewardCard);
      });
    }

    function openRewardModal(rewardId = null, e) {
      if (e) e.stopPropagation();
      editingRewardId = rewardId;
      const form = document.getElementById('rewardForm');
      if (rewardId) {
        const reward = gameState.rewards.find(r => r.id === rewardId);
        if (reward) {
          document.getElementById('rewardTitle').value = reward.title;
          document.getElementById('rewardNotes').value = reward.notes;
          document.getElementById('rewardPrice').value = reward.price;
          document.getElementById('rewardTags').value = reward.tags;
        }
      } else {
        form.reset();
        document.getElementById('rewardTitle').value = '';
        document.getElementById('rewardNotes').value = '';
        document.getElementById('rewardPrice').value = 10;
        document.getElementById('rewardTags').value = '';
      }
      openModal('rewardModal');
    }

    document.getElementById('rewardForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const rewardData = {
        title: formData.get('title'),
        notes: formData.get('notes'),
        price: parseInt(formData.get('price'), 10),
        tags: formData.get('tags')
      };
      if (editingRewardId) {
        const rewardIndex = gameState.rewards.findIndex(r => r.id === editingRewardId);
        if (rewardIndex !== -1) {
          gameState.rewards[rewardIndex] = { ...gameState.rewards[rewardIndex], ...rewardData };
          updateRewardsList();
        }
      } else {
        const newReward = {
          id: Date.now(),
          ...rewardData
        };
        gameState.rewards.push(newReward);
        updateRewardsList();
      }
      closeModal('rewardModal');
      showNotification('Reward saved successfully!', 'success');
    });

    function deleteReward(rewardId, e) {
      if (e) e.stopPropagation();
      if (confirm('Are you sure you want to delete this reward?')) {
        gameState.rewards = gameState.rewards.filter(r => r.id !== rewardId);
        updateRewardsList();
        closeModal('rewardModal');
        showNotification('Reward deleted successfully!', 'success');
      }
    }

    function buyReward(rewardId, e) {
      if (e) e.stopPropagation();
      const reward = gameState.rewards.find(r => r.id === rewardId);
      if (!reward) return;
      if (gameState.coins >= reward.price) {
        gameState.coins -= reward.price;
        showNotification('Reward purchased!', 'success');
        updateDisplay();
      } else {
        showNotification('Not enough coins!', 'warning');
      }
    }

    // Special rewards (visual/items)
    function updateSpecialRewardsList() {
      const specialList = document.getElementById('specialRewardsList');
      specialList.innerHTML = '';
      gameState.specialRewards.forEach(item => {
        const card = document.createElement('div');
        card.className = 'reward-card';
        card.innerHTML = `
          <div class="reward-icon"><img src="${item.icon}" alt="${item.title}" style="width:40px;height:40px;"></div>
          <div>${item.title}</div>
          <div class="reward-cost"><i class="fa-solid fa-coins"></i> ${item.price}</div>
        `;
        card.onclick = () => openSpecialRewardModal(item.id);
        specialList.appendChild(card);
      });
    }

    function openSpecialRewardModal(itemId) {
      viewingSpecialRewardId = itemId;
      const item = gameState.specialRewards.find(i => i.id === itemId);
      if (!item) return;
      document.getElementById('specialRewardTitle').textContent = item.title;
      document.getElementById('specialRewardDesc').textContent = item.description;
      document.getElementById('specialRewardIcon').src = item.icon;
      document.getElementById('specialRewardPrice').textContent = item.price;
      document.getElementById('specialRewardStr').textContent = item.bonuses.str;
      document.getElementById('specialRewardInt').textContent = item.bonuses.int;
      document.getElementById('specialRewardCon').textContent = item.bonuses.con;
      document.getElementById('specialRewardPer').textContent = item.bonuses.per;
      document.getElementById('specialRewardModal').classList.add('active');
    }

    function buySpecialReward() {
      const item = gameState.specialRewards.find(i => i.id === viewingSpecialRewardId);
      if (!item) return;
      if (gameState.coins >= item.price) {
        gameState.coins -= item.price;
        // Применить бонусы к персонажу (например, увеличить силу)
        // ...
        showNotification('Item purchased! Bonuses applied.', 'success');
        updateDisplay();
        closeModal('specialRewardModal');
      } else {
        showNotification('Not enough coins!', 'warning');
      }
    }

    // Initialize the game when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initGame();
      updateHabitsList();
      updateDailiesList();
      updateTodosList();
      updateRewardsList();
      updateSpecialRewardsList();
    });
  </script>
</body>
</html>